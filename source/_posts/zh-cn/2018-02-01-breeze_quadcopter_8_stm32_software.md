---
title: Breeze微型四轴系列（八）：软件开发总结
date: 2018-02-01 20:00:00
tags:
  - Micro Quadcopter
  - STM32
  - GCS
  - Qt
categories: Breeze微型四轴系列
description: 本篇文章介绍Breeze微型四轴飞行器软件开发的相关内容。
feature: /images/breeze/breeze.png
toc: true
comments: true
---

## 前言

一款出色的四轴飞行器除了要有设计严谨的硬件、稳定可靠的飞控之外，还需要具有图形界面的上位机以及可扩展软件接口才行。毕竟对于那些基于四轴飞行器平台进行深入研究（比如视觉SLAM、视觉避障、室内自主悬停等）的学者来说，带有各种参数仪表盘和数据曲线显示功能的地面控制站可直观地显示出当前四轴飞行器在空中的运动姿态和相关传感器数据等信息，便于算法调试。此外，四轴飞控所集成的软件接口API也能够加快上层应用的开发速度，提高其与其他开源框架（ROS、OpenCV、PCL、TensorFlow等）的集成和交互能力。

因此，本篇文章会以Breeze微型四轴飞行器为例来简要介绍目前国内外几个比较成熟的四轴飞行器地面控制站（GCS）软件以及软件接口协议，欢迎各位前来阅读。

<!--more-->

## 内容

### 地面控制站

- #### Breeze远程控制站

  如下图所示，Breeze远程控制站是我在Windows操作系统下使用Qt5进行编写的，代码里面主要调用了Qt官方的串口库和摄像头驱动库。它实现的功能比较简单，主要包含以下两个功能，其中第一个功能是该远程控制站软件可通过我们自定义的串口通信协议实时获取Breeze微型四轴飞行器当前的飞行姿态数据并显示在接收窗口内，另一个功能则是能够根据当前键盘上被按下的按键来发送对应的控制命令给四轴飞行器，从而完成操作者对Breeze微型四轴飞行器的远程控制。

  ![breeze_remote_control_1](/images/breeze/software/breeze_remote_control_1.png)

  以下图片展示了Breeze远程控制站所集成的实时视频流采集功能。摄像头安装在四轴飞行器的顶部，可通过2.4GHz无线图传与PC相连完成实时图像的传输，不过由于时间的缘故，我们目前只实现了图像数据的采集，而图像检测和识别等有关机器视觉方面的高级功能暂时还未完成。最后，Breeze远程控制站的代码可以点击[这里](https://github.com/microdynamics-quadcopter/breeze_remote_control)获得。

  ![breeze_remote_control_2](/images/breeze/software/breeze_remote_control_2.png)

- #### Breeze飞行控制站

  Breeze飞行控制站是我根据西工大布树辉老师在GitHub上开源的[Qt飞行仪表盘插件](https://github.com/bushuhui/qFlightInstruments)和西工大舞蹈机器人基地马文科学长所创立[HandsFree项目](https://github.com/HANDS-FREE)中HFLink代码的基础上进行重构开发而来。该软件外部的图形界面使用了目前Ubuntu下最流行和强大的Qt5框架，而内部则采用自定义的CommLink通信协议库实现Breeze和PC之间双向的数据传输。当然，依然受限于时间等客观因素，Breeze飞行控制站和上面介绍过的远程控制站一样目前只是一个Demo，很多功能还未实现，还需未来继续改进。

  如下图所示，Breeze飞行控制站的界面主要分为**飞行指示器**、**飞行状态**和**飞行数据**共三个区域，其中**飞行指示器**区域通过三个仪表盘分别显示Breeze微型四轴飞行器实时的飞行姿态、海拔高度和磁场方向等数据，左下角的**飞行状态**区域用于显示四轴飞行器当前的推力值、四个电机的转速值以及电池电量值等，而右下角的**飞行数据**区域则以浮点数的形式展现**飞行指示器**和**飞行状态**中的数值，使数据大小的显示更为直观。最后，Breeze飞行控制站的代码可以点击[这里](https://github.com/microdynamics-quadcopter/breeze_flight_control_station)获得。

  ![breeze_flight_control_station](/images/breeze/software/breeze_flight_control_station.png)

- #### 匿名科创地面站

- #### APM Planner

### 软件接口协议

未完待续。。。

## 总结

### 项目

- #### 完成

  本次项目开发从软硬件两方面共同完成了第一代Breeze微型四轴飞行器系统的搭建工作，初步实现了四轴飞行器的简单受控飞行。在整个系统开发的过程中主要完成了Breeze微型四轴飞行器的硬件电路设计、嵌入式程序开发以及上层软件编写和调试等工作内容。

- #### 改进

  由于四轴飞行器所涉及的技术面较广、本人水平有限以及受到研究经费、试验条件等客观因素的影响，本次项目开发对四轴飞行器飞控系统的研究还不够深入，仍存在以下问题，需要在今后的研究中不断学习和优化：

  1. 由于时间和经费的原因，目前Breeze微型四轴飞行器的硬件电路设计还不够封装化和模块化，而且一些电路设计得比较复杂，不利于后期的进一步维护和改进。

  2. 本次项目开发使用C语言来编写嵌入式代码，但由于C语言是面向过程的高级语言，它对源码的封装性远不如基于面向对象思想的C++。此外，目前Breeze微型四轴飞行器的通信协议设计得比较冗余，而且功能也比较有限。

  3. 本次项目开发对飞控算法的研究并未深入，只是研究了目前比较流行的Mahony互补滤波算法并在Breeze微型四轴飞行器上测试了其效果。

  4. 本次项目开发未涉及ROS（Robot Operating System，即机器人操作系统）方面的内容。不过由于ROS目前已经成为机器人软件开发的事实标准，将来我们也会尝试基于ROS来搭建整个四轴飞行器的上层软件架构。

### 个人

- #### 感受

  在本次项目开发的过程中，困扰我比较大的就是硬件电路的设计工作。因为我之前没有系统地学习过如何绘制PCB板，所以在开发的前期阶段，我不得不花很多时间来学习如何使用Altium Designer软件，而且由于缺乏硬件设计的相关经验，我的前几次元器件布局很不合理，这直接导致了后来在进行布线的时候，PCB板出现过孔数量的过多和乃至无法布通的情况。后来在经历了痛苦的重新布局、布线并解决了很多违反规则的问题之后，硬件电路终于被我成功地设计了出来，不过最后令人遗憾的是我没能完成对PCB板的焊接。因为本项目的硬件设计中使用了几个QFN封装形式的IC芯片，而IC芯片普遍对焊接时的温度要求比较高，而且最关键的是这些芯片的焊盘全都被放置在了黑色塑料壳体的下面而没有伸出来，这就导致了在焊接IC的过程中很容易发生短焊或虚焊的情况。虽然我尽可能地提高自己的焊接水平，但依然还是有很多块PCB板和价格不菲的IC芯片被我焊坏了，最后迫于开发进度的安排，我只能放弃焊接而使用我之前学习飞控时用到的成品四轴飞行器。尽管本次我没能完成硬件的制作，但我却收获了别人没有的宝贵经验，我相信学习总要有一个交学费的过程，希望这次经历可以让我在未来的开发过程中做得更好。

  总之，经历了本次项目开发，我对四轴飞行器的整体系统构成以及各模块之间的相互关系有了一个更加深刻的理解，同时在开发的过程中，我学到了很多专业领域的知识，也认识到了自身的不足之处。最后，我通过GitHub开源了目前的所有设计成果，希望能让更多的人能有机会亲身参与到四轴飞行器的开发过程中来，并能乐享其中。

- #### 致谢

  感谢与我一同创立了MicroDynamics团队以及Breeze微型四轴飞行器项目的队友maksyuki，这个项目的想法是他最先提出来的。感谢他前期对嵌入式开发以及飞控算法的基础性研究，让我可以有充裕的时间来设计并焊接四轴飞行器的硬件电路部分。

  感谢西北工业大学舞蹈机器人基地为我创造了一个良好的开发环境，让我可以自由地使用元器件和工具来完成四轴飞行器的焊接、安装和调试工作。感谢马文科学长在硬件电路设计和飞控算法上给我提供的帮助，同时也要感谢他所创立的HandsFree开源机器人软硬件项目为本次项目开发提供的技术支持。

  感谢Crazepony和Crazyflie这两个开源四轴飞行器项目，感谢它们无私提供的硬件电路设计和嵌入式代码对本次项目开发的帮助。

  感谢本次项目开发中所使用的一切开源软硬件工具以及它们的创造者，没有这些工具的存在，我的这个项目也就不能实现。

  再次感谢西北工业大学舞蹈机器人基地及其全体成员，感谢他们创造了一个自由且充满激情的世界，让我可以在有限的基地时光中学到很多不同领域的知识，并为我之后的研究学习打下了坚实的基础。

{% alert info %}
普通个人转载请注明出处。获得许可后，要求转载时保留注明出处和网站链接，谢谢！
{% endalert %}
